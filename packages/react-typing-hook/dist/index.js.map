{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import { useEffect, useRef, RefObject } from \"react\";\r\n\r\nimport './index.css'\r\n\r\ntype Typing<T> = (node: T, speed: number, ...args: TypingSteps<T>) => Promise<void>\r\n\r\ntype Editor<T> = (node: T) => number\r\n\r\ntype GeneratorEditor<T> = Generator<Editor<T>, void, Editor<T>>\r\n\r\ntype TypingSteps<T> = Array<string | number | (() => any) | Typing<T>>\r\n\r\nexport interface TypingOptions<T> {\r\n  steps: TypingSteps<T>,\r\n  loop?: number,\r\n  speed?: number\r\n}\r\n\r\nexport default function useTyping<T extends HTMLElement>({ steps, loop, speed = 60 } : TypingOptions<T>) : RefObject<T> {\r\n\r\n  const ref = useRef<T>(null);\r\n\r\n  async function typing<T extends HTMLElement>(node: T, speed: number, ...args: TypingSteps<T>): Promise<void> {\r\n    for (const arg of args) {\r\n      switch (typeof arg) {\r\n        case \"string\":\r\n          await edit(node, speed, arg);\r\n          break;\r\n        case \"number\":\r\n          await wait(arg);\r\n          break;\r\n        case \"function\":\r\n          await arg(node, speed, ...args);\r\n          break;\r\n        default:\r\n          await arg;\r\n      }\r\n    }\r\n  }\r\n\r\n  async function edit<T extends HTMLElement>(node: T, speed: number, text: string): Promise<void> {\r\n    const textContent = node.textContent || '';\r\n    const overlap = getOverlap(textContent, text);\r\n    await perform<T>(node, speed, [\r\n      ...deleter(textContent, overlap) as Iterable<string>,\r\n      ...writer(text, overlap) as Iterable<string>,\r\n    ]);\r\n  }\r\n\r\n  async function wait(ms: number): Promise<void> {\r\n    await new Promise((resolve) => setTimeout(resolve, ms));\r\n  }\r\n\r\n  async function perform<T>(node: T, speed: number, edits: Iterable<string>): Promise<void> {\r\n    for (const op of editor(edits) as Iterable<Editor<T>>) {\r\n      op(node);\r\n      await wait(speed + speed * (Math.random() - 0.5));\r\n    }\r\n  }\r\n\r\n  function* editor<T extends HTMLElement>(edits: Iterable<string>): GeneratorEditor<T> {\r\n    for (const edit of edits) {\r\n      yield (node: T) => requestAnimationFrame(() => (node.textContent = edit));\r\n    }\r\n  }\r\n\r\n  function* writer([...text]: Iterable<string>, startIndex = 0, endIndex = text.length): Generator<string, void, string> {\r\n    while (startIndex < endIndex) {\r\n      yield text.slice(0, ++startIndex).join(\"\");\r\n    }\r\n  }\r\n\r\n  function* deleter([...text]: Iterable<string>, startIndex = 0, endIndex = text.length): Generator<string, void, string> {\r\n    while (endIndex > startIndex) {\r\n      yield text.slice(0, --endIndex).join(\"\");\r\n    }\r\n  }\r\n\r\n  function getOverlap(start: string, [...end]: string): number {\r\n    return [...start, NaN].findIndex((char, i) => end[i] !== char);\r\n  }\r\n\r\n  const loopedType = typing;\r\n\r\n  useEffect(() => {\r\n\r\n    if(ref.current != null) {\r\n      if (loop === Infinity) {\r\n        typing(ref.current, speed, ...steps, loopedType);\r\n      } else if (typeof loop === \"number\") {\r\n        typing(\r\n          ref.current,\r\n          speed,\r\n          ...Array(loop)\r\n            .fill(steps)\r\n            .flat()\r\n        );\r\n      } else {\r\n        typing(ref.current, speed, ...steps);\r\n      }\r\n    }\r\n    \r\n  }, []);\r\n\r\n  return ref\r\n}\r\n\r\n"],"names":["useRef","useEffect"],"mappings":"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"}