{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import { useLayoutEffect, RefObject } from \"react\";\r\nimport './index.css'\r\n\r\n/**\r\n * React Hook Wrapper\r\n * @param ref \r\n * @param param1 \r\n */\r\nexport default function useTyping(ref: RefObject<HTMLDocument>, { steps, loop } : TypingOptions) {\r\n  const loopedType = typing;\r\n  useLayoutEffect(() => {\r\n    if(ref.current === null) return undefined;\r\n    \r\n    if (loop === Infinity) {\r\n      typing(ref.current, ...steps, loopedType);\r\n    } else if (typeof loop === \"number\") {\r\n      typing(\r\n        ref.current,\r\n        ...Array(loop)\r\n          .fill(steps)\r\n          .flat()\r\n      );\r\n    } else {\r\n      typing(ref.current, ...steps);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Typing core logic\r\n * @param node \r\n * @param args \r\n */\r\nexport async function typing(node: HTMLDocument, ...args: Array<TypeArgs>): Promise<void> {\r\n  for (const arg of args) {\r\n    switch (typeof arg) {\r\n      case \"string\":\r\n        await edit(node, arg);\r\n        break;\r\n      case \"number\":\r\n        await wait(arg);\r\n        break;\r\n      case \"function\":\r\n        await arg(node, ...args);\r\n        break;\r\n      default:\r\n        await arg;\r\n    }\r\n  }\r\n}\r\n\r\nasync function edit(node: HTMLDocument, text: string): Promise<void> {\r\n  const textContent = node.textContent || '';\r\n  const overlap = getOverlap(textContent, text);\r\n  await perform(node, [\r\n    ...deleter(textContent, overlap) as Iterable<string>,\r\n    ...writer(text, overlap) as Iterable<string>,\r\n  ]);\r\n}\r\n\r\nasync function wait(ms: number): Promise<void> {\r\n  await new Promise((resolve) => setTimeout(resolve, ms));\r\n}\r\n\r\nasync function perform(node: HTMLDocument, edits: Iterable<string>, speed = 60): Promise<void> {\r\n  for (const op of editor(edits) as Iterable<Editor>) {\r\n    op(node);\r\n    await wait(speed + speed * (Math.random() - 0.5));\r\n  }\r\n}\r\n\r\nexport function* editor(edits: Iterable<string>): GeneratorEditor {\r\n  for (const edit of edits) {\r\n    yield (node: HTMLDocument) => requestAnimationFrame(() => (node.textContent = edit));\r\n  }\r\n}\r\n\r\nexport function* writer([...text]: Iterable<string>, startIndex = 0, endIndex = text.length): Generator<string, void, string> {\r\n  while (startIndex < endIndex) {\r\n    yield text.slice(0, ++startIndex).join(\"\");\r\n  }\r\n}\r\n\r\nexport function* deleter([...text]: Iterable<string>, startIndex = 0, endIndex = text.length): Generator<string, void, string> {\r\n  while (endIndex > startIndex) {\r\n    yield text.slice(0, --endIndex).join(\"\");\r\n  }\r\n}\r\n\r\nexport function getOverlap(start: string, [...end]: string): number {\r\n  return [...start, NaN].findIndex((char, i) => end[i] !== char);\r\n}"],"names":["useLayoutEffect"],"mappings":"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"}