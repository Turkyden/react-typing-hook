{"version":3,"file":"useTyping.js","sources":["../src/index.ts"],"sourcesContent":["import { useEffect, RefObject } from \"react\";\r\nimport './index.css'\r\n\r\n/**\r\n * React Hook Wrapper\r\n * @param ref \r\n * @param param1 \r\n */\r\nexport default function useTyping(ref: RefObject<HTMLDocument | null>, { steps, loop, speed = 60 } : TypingOptions) {\r\n\r\n  async function typing(node: HTMLDocument, speed: number, ...args: TypingSteps): Promise<void> {\r\n    for (const arg of args) {\r\n      switch (typeof arg) {\r\n        case \"string\":\r\n          await edit(node, speed, arg);\r\n          break;\r\n        case \"number\":\r\n          await wait(arg);\r\n          break;\r\n        case \"function\":\r\n          await arg(node, speed, ...args);\r\n          break;\r\n        default:\r\n          await arg;\r\n      }\r\n    }\r\n  }\r\n\r\n  async function edit(node: HTMLDocument, speed: number, text: string): Promise<void> {\r\n    const textContent = node.textContent || '';\r\n    const overlap = getOverlap(textContent, text);\r\n    await perform(node, speed, [\r\n      ...deleter(textContent, overlap) as Iterable<string>,\r\n      ...writer(text, overlap) as Iterable<string>,\r\n    ]);\r\n  }\r\n\r\n  async function wait(ms: number): Promise<void> {\r\n    await new Promise((resolve) => setTimeout(resolve, ms));\r\n  }\r\n\r\n  async function perform(node: HTMLDocument, speed: number, edits: Iterable<string>): Promise<void> {\r\n    for (const op of editor(edits) as Iterable<Editor>) {\r\n      op(node);\r\n      await wait(speed + speed * (Math.random() - 0.5));\r\n    }\r\n  }\r\n\r\n  function* editor(edits: Iterable<string>): GeneratorEditor {\r\n    for (const edit of edits) {\r\n      yield (node: HTMLDocument) => requestAnimationFrame(() => (node.textContent = edit));\r\n    }\r\n  }\r\n\r\n  function* writer([...text]: Iterable<string>, startIndex = 0, endIndex = text.length): Generator<string, void, string> {\r\n    while (startIndex < endIndex) {\r\n      yield text.slice(0, ++startIndex).join(\"\");\r\n    }\r\n  }\r\n\r\n  function* deleter([...text]: Iterable<string>, startIndex = 0, endIndex = text.length): Generator<string, void, string> {\r\n    while (endIndex > startIndex) {\r\n      yield text.slice(0, --endIndex).join(\"\");\r\n    }\r\n  }\r\n\r\n  function getOverlap(start: string, [...end]: string): number {\r\n    return [...start, NaN].findIndex((char, i) => end[i] !== char);\r\n  }\r\n\r\n  const loopedType = typing;\r\n\r\n  useEffect(() => {\r\n    if(ref.current === null) return undefined;\r\n    \r\n    if (loop === Infinity) {\r\n      typing(ref.current, speed, ...steps, loopedType);\r\n    } else if (typeof loop === \"number\") {\r\n      typing(\r\n        ref.current,\r\n        speed,\r\n        ...Array(loop)\r\n          .fill(steps)\r\n          .flat()\r\n      );\r\n    } else {\r\n      typing(ref.current, speed, ...steps);\r\n    }\r\n  });\r\n}\r\n\r\n"],"names":["useEffect"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAGA;;;;;aAKwB,SAAS,CAAC,GAAmC,EAAE,EAA2C;YAAzC,KAAK,WAAA,EAAE,IAAI,UAAA,EAAE,aAAU,EAAV,KAAK,mBAAG,EAAE,KAAA;QAE9F,SAAe,MAAM,CAAC,IAAkB,EAAE,KAAa;YAAE,cAAoB;iBAApB,UAAoB,EAApB,qBAAoB,EAApB,IAAoB;gBAApB,6BAAoB;;;;;;;;;4BACzD,SAAA,SAAA,IAAI,CAAA;;;;4BAAX,GAAG;4BACJ,KAAA,OAAO,GAAG,CAAA;;qCACX,QAAQ,EAAR,wBAAQ;qCAGR,QAAQ,EAAR,wBAAQ;qCAGR,UAAU,EAAV,wBAAU;;;gCALb,qBAAM,IAAI,CAAC,IAAI,EAAE,KAAK,EAAE,GAAG,CAAC,EAAA;;4BAA5B,SAA4B,CAAC;4BAC7B,yBAAM;gCAEN,qBAAM,IAAI,CAAC,GAAG,CAAC,EAAA;;4BAAf,SAAe,CAAC;4BAChB,yBAAM;gCAEN,qBAAM,GAAG,yBAAC,IAAI,EAAE,KAAK,GAAK,IAAI,IAAC;;4BAA/B,SAA+B,CAAC;4BAChC,yBAAM;gCAEN,qBAAM,GAAG,EAAA;;4BAAT,SAAS,CAAC;;;;;;;;;;;;;;;;;;;;SAGjB;QAED,SAAe,IAAI,CAAC,IAAkB,EAAE,KAAa,EAAE,IAAY;;;;;;4BAC3D,WAAW,GAAG,IAAI,CAAC,WAAW,IAAI,EAAE,CAAC;4BACrC,OAAO,GAAG,UAAU,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;4BAC9C,qBAAM,OAAO,CAAC,IAAI,EAAE,KAAK,WACpB,OAAO,CAAC,WAAW,EAAE,OAAO,CAAqB,EACjD,MAAM,CAAC,IAAI,EAAE,OAAO,CAAqB,EAC5C,EAAA;;4BAHF,SAGE,CAAC;;;;;SACJ;QAED,SAAe,IAAI,CAAC,EAAU;;;;gCAC5B,qBAAM,IAAI,OAAO,CAAC,UAAC,OAAO,IAAK,OAAA,UAAU,CAAC,OAAO,EAAE,EAAE,CAAC,GAAA,CAAC,EAAA;;4BAAvD,SAAuD,CAAC;;;;;SACzD;QAED,SAAe,OAAO,CAAC,IAAkB,EAAE,KAAa,EAAE,KAAuB;;;;;;;;4BAC9D,KAAA,SAAA,MAAM,CAAC,KAAK,CAAqB,CAAA;;;;4BAAvC,EAAE;4BACX,EAAE,CAAC,IAAI,CAAC,CAAC;4BACT,qBAAM,IAAI,CAAC,KAAK,GAAG,KAAK,IAAI,IAAI,CAAC,MAAM,EAAE,GAAG,GAAG,CAAC,CAAC,EAAA;;4BAAjD,SAAiD,CAAC;;;;;;;;;;;;;;;;;;;;SAErD;QAED,SAAU,MAAM,CAAC,KAAuB;;;;;;4CAC3B,MAAI;;;4CACb,qBAAM,UAAC,IAAkB,IAAK,OAAA,qBAAqB,CAAC,cAAM,QAAC,IAAI,CAAC,WAAW,GAAG,MAAI,IAAC,CAAC,GAAA,EAAA;;wCAApF,SAAoF,CAAC;;;;;;;;wBADpE,UAAA,SAAA,KAAK,CAAA;;;;wBAAnB;sDAAM,MAAI;;;;;;;;;;;;;;;;;;;;;SAGhB;QAED,SAAU,MAAM,CAAC,EAA2B,EAAE,UAAc,EAAE,QAAsB;gBAAnE,KAAA,UAA2B,EAAvB,IAAI,cAAA;YAAqB,2BAAA,EAAA,cAAc;YAAE,yBAAA,EAAA,WAAW,IAAI,CAAC,MAAM;;;;8BAC3E,UAAU,GAAG,QAAQ,CAAA;wBAC1B,qBAAM,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,UAAU,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,EAAA;;wBAA1C,SAA0C,CAAC;;;;;SAE9C;QAED,SAAU,OAAO,CAAC,EAA2B,EAAE,UAAc,EAAE,QAAsB;gBAAnE,KAAA,UAA2B,EAAvB,IAAI,cAAA;YAAqB,2BAAA,EAAA,cAAc;YAAE,yBAAA,EAAA,WAAW,IAAI,CAAC,MAAM;;;;8BAC5E,QAAQ,GAAG,UAAU,CAAA;wBAC1B,qBAAM,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,QAAQ,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,EAAA;;wBAAxC,SAAwC,CAAC;;;;;SAE5C;QAED,SAAS,UAAU,CAAC,KAAa,EAAE,EAAgB;gBAAhB,KAAA,UAAgB,EAAZ,GAAG,cAAA;YACxC,OAAO,SAAI,KAAK,GAAE,GAAG,GAAE,SAAS,CAAC,UAAC,IAAI,EAAE,CAAC,IAAK,OAAA,GAAG,CAAC,CAAC,CAAC,KAAK,IAAI,GAAA,CAAC,CAAC;SAChE;QAED,IAAM,UAAU,GAAG,MAAM,CAAC;QAE1BA,eAAS,CAAC;YACR,IAAG,GAAG,CAAC,OAAO,KAAK,IAAI;gBAAE,OAAO,SAAS,CAAC;YAE1C,IAAI,IAAI,KAAK,QAAQ,EAAE;gBACrB,MAAM,yBAAC,GAAG,CAAC,OAAO,EAAE,KAAK,GAAK,KAAK,GAAE,UAAU,IAAE;aAClD;iBAAM,IAAI,OAAO,IAAI,KAAK,QAAQ,EAAE;gBACnC,MAAM,yBACJ,GAAG,CAAC,OAAO;oBACX,KAAK,GACF,KAAK,CAAC,IAAI,CAAC;qBACX,IAAI,CAAC,KAAK,CAAC;qBACX,IAAI,EAAE,GACT;aACH;iBAAM;gBACL,MAAM,yBAAC,GAAG,CAAC,OAAO,EAAE,KAAK,GAAK,KAAK,GAAE;aACtC;SACF,CAAC,CAAC;IACL;;;;;;;;"}