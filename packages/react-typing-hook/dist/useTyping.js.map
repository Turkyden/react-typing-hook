{"version":3,"file":"useTyping.js","sources":["../src/index.ts"],"sourcesContent":["import { useEffect, useRef, RefObject } from \"react\";\r\n\r\nimport './index.css'\r\n\r\ntype Typing<T> = (node: T, speed: number, ...args: TypingSteps<T>) => Promise<void>\r\n\r\ntype Editor<T> = (node: T) => number\r\n\r\ntype GeneratorEditor<T> = Generator<Editor<T>, void, Editor<T>>\r\n\r\ntype TypingSteps<T> = Array<string | number | (() => any) | Typing<T>>\r\n\r\nexport interface TypingOptions<T> {\r\n  steps: TypingSteps<T>,\r\n  loop?: number,\r\n  speed?: number\r\n}\r\n\r\nexport default function useTyping<T extends HTMLElement>({ steps, loop, speed = 60 } : TypingOptions<T>) : RefObject<T> {\r\n\r\n  const ref = useRef<T>(null);\r\n\r\n  async function typing<T extends HTMLElement>(node: T, speed: number, ...args: TypingSteps<T>): Promise<void> {\r\n    for (const arg of args) {\r\n      switch (typeof arg) {\r\n        case \"string\":\r\n          await edit(node, speed, arg);\r\n          break;\r\n        case \"number\":\r\n          await wait(arg);\r\n          break;\r\n        case \"function\":\r\n          await arg(node, speed, ...args);\r\n          break;\r\n        default:\r\n          await arg;\r\n      }\r\n    }\r\n  }\r\n\r\n  async function edit<T extends HTMLElement>(node: T, speed: number, text: string): Promise<void> {\r\n    const textContent = node.textContent || '';\r\n    const overlap = getOverlap(textContent, text);\r\n    await perform<T>(node, speed, [\r\n      ...deleter(textContent, overlap) as Iterable<string>,\r\n      ...writer(text, overlap) as Iterable<string>,\r\n    ]);\r\n  }\r\n\r\n  async function wait(ms: number): Promise<void> {\r\n    await new Promise((resolve) => setTimeout(resolve, ms));\r\n  }\r\n\r\n  async function perform<T>(node: T, speed: number, edits: Iterable<string>): Promise<void> {\r\n    for (const op of editor(edits) as Iterable<Editor<T>>) {\r\n      op(node);\r\n      await wait(speed + speed * (Math.random() - 0.5));\r\n    }\r\n  }\r\n\r\n  function* editor<T extends HTMLElement>(edits: Iterable<string>): GeneratorEditor<T> {\r\n    for (const edit of edits) {\r\n      yield (node: T) => requestAnimationFrame(() => (node.textContent = edit));\r\n    }\r\n  }\r\n\r\n  function* writer([...text]: Iterable<string>, startIndex = 0, endIndex = text.length): Generator<string, void, string> {\r\n    while (startIndex < endIndex) {\r\n      yield text.slice(0, ++startIndex).join(\"\");\r\n    }\r\n  }\r\n\r\n  function* deleter([...text]: Iterable<string>, startIndex = 0, endIndex = text.length): Generator<string, void, string> {\r\n    while (endIndex > startIndex) {\r\n      yield text.slice(0, --endIndex).join(\"\");\r\n    }\r\n  }\r\n\r\n  function getOverlap(start: string, [...end]: string): number {\r\n    return [...start, NaN].findIndex((char, i) => end[i] !== char);\r\n  }\r\n\r\n  const loopedType = typing;\r\n\r\n  useEffect(() => {\r\n\r\n    if(ref.current != null) {\r\n      if (loop === Infinity) {\r\n        typing(ref.current, speed, ...steps, loopedType);\r\n      } else if (typeof loop === \"number\") {\r\n        typing(\r\n          ref.current,\r\n          speed,\r\n          ...Array(loop)\r\n            .fill(steps)\r\n            .flat()\r\n        );\r\n      } else {\r\n        typing(ref.current, speed, ...steps);\r\n      }\r\n    }\r\n    \r\n  }, []);\r\n\r\n  return ref\r\n}\r\n\r\n"],"names":["useRef","useEffect"],"mappings":"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"}